(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},7316:(e,o,t)=>{"use strict";t.d(o,{F:()=>s,SocketProvider:()=>l});var r=t(5155),n=t(2115),c=t(4298),i=t(3568);let a=(0,n.createContext)(null);function s(){let e=(0,n.useContext)(a);if(!e)throw Error("useSocket must be used within a SocketProvider");return e}function l(e){let{children:o}=e,[t,s]=(0,n.useState)(null),[l,d]=(0,n.useState)(!1),[m,u]=(0,n.useState)("disconnected"),[v,y]=(0,n.useState)(null);return(0,n.useEffect)(()=>{u("connecting");let e=(0,c.io)("wss://mafia-ai-production.up.railway.app",{transports:["websocket","polling"],timeout:2e4,retries:3,query:{clientType:"game"}});return e.on("connect",()=>{d(!0),u("connected"),i.Ay.success("Connected to game server!",{icon:"\uD83D\uDD75️‍♂️"})}),e.on("disconnect",e=>{d(!1),u("disconnected"),"io server disconnect"===e&&i.Ay.error("Server disconnected. Attempting to reconnect...")}),e.on("connect_error",e=>{u("error"),i.Ay.error("Failed to connect to game server. Retrying...")}),e.on("reconnect",e=>{i.Ay.success("Reconnected to game server!")}),e.on("reconnect_error",e=>{i.Ay.error("Failed to reconnect. Please refresh the page.")}),e.on("room_joined",e=>{i.Ay.success("Joined room ".concat(e.roomCode,"!"),{icon:"\uD83C\uDFAE"})}),e.on("room_created",e=>{i.Ay.success("Room ".concat(e.roomCode," created!"),{icon:"\uD83C\uDFAF"})}),e.on("player_joined",e=>{(0,i.Ay)("".concat(e.player.name," joined the game"),{icon:"\uD83D\uDC4B"})}),e.on("player_left",e=>{(0,i.Ay)("A player left the game",{icon:"\uD83D\uDEAA"})}),e.on("game_started",e=>{i.Ay.success("The game has begun! Good luck, detective!",{icon:"\uD83D\uDD75️‍♂️",duration:6e3})}),e.on("phase_changed",e=>{let o={night:"Night falls... \uD83C\uDF19",revelation:"Morning reveals the truth... ☀️",discussion:"Time for discussion! \uD83D\uDCAC",voting:"Time to vote! \uD83D\uDDF3️",game_over:"Game Over! \uD83C\uDFAE"}[e.newPhase]||"Phase: ".concat(e.newPhase);(0,i.Ay)(o,{icon:"⏰",duration:3e3})}),e.on("player_eliminated",e=>{i.Ay.error("".concat(e.playerName," was eliminated! They were a ").concat(e.role),{icon:"\uD83D\uDC80",duration:8e3})}),e.on("game_ended",e=>{let o="citizens"===e.winner?"Citizens won!":"Mafia won!";i.Ay.success("Game Over! ".concat(o),{icon:"citizens"===e.winner?"\uD83D\uDC6E‍♂️":"\uD83D\uDD74️",duration:1e4})}),e.on("error",e=>{i.Ay.error(e.message||"An error occurred")}),e.on("stats_update",e=>{var o,t,r;y({totalPlayers:(null==(o=e.server)?void 0:o.activeConnections)||0,activeGames:(null==(t=e.rooms)?void 0:t.activeRooms)||0,totalRooms:(null==(r=e.rooms)?void 0:r.totalRooms)||0})}),s(e),()=>{e.disconnect()}},[]),(0,n.useEffect)(()=>{if(!t||!l)return;let e=()=>{fetch("".concat("https://mafia-ai-production.up.railway.app","/api/stats")).then(e=>e.json()).then(e=>{var o,t,r;y({totalPlayers:(null==(o=e.server)?void 0:o.activeConnections)||0,activeGames:(null==(t=e.rooms)?void 0:t.activeRooms)||0,totalRooms:(null==(r=e.rooms)?void 0:r.totalRooms)||0})}).catch(console.error)};e();let o=setInterval(e,5e3);return()=>clearInterval(o)},[t,l]),(0,r.jsx)(a.Provider,{value:{socket:t,isConnected:l,connectionStatus:m,serverStats:v,joinRoom:(e,o)=>{if(!t)return void i.Ay.error("Not connected to server");t.emit("join_room",{roomCode:e.toUpperCase(),playerName:o.trim()})},createRoom:function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return void i.Ay.error("Not connected to server");t.emit("create_room",{playerName:e.trim(),roomSettings:{allowSpectators:!1,premiumModelsEnabled:!1,...o}})},sendMessage:e=>{if(!t)return void i.Ay.error("Not connected to server");t.emit("game_action",{type:"SEND_MESSAGE",content:e.trim()})},castVote:(e,o)=>{if(!t)return void i.Ay.error("Not connected to server");t.emit("game_action",{type:"CAST_VOTE",targetId:e,reasoning:o.trim()})},nightAction:(e,o)=>{if(!t)return void i.Ay.error("Not connected to server");t.emit("game_action",{type:"NIGHT_ACTION",action:e,targetId:o})},disconnect:()=>{t&&(t.disconnect(),s(null),d(!1),u("disconnected"))}},children:o})}},9453:(e,o,t)=>{Promise.resolve().then(t.t.bind(t,9993,23)),Promise.resolve().then(t.bind(t,3568)),Promise.resolve().then(t.t.bind(t,347,23)),Promise.resolve().then(t.bind(t,7316))},9993:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c",variable:"__variable_e8ce0c"}}},e=>{var o=o=>e(e.s=o);e.O(0,[180,299,441,684,358],()=>o(9453)),_N_E=e.O()}]);